<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="global vein string:contents;"
  i18n:domain="silva">

<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main">

<form action="."
  method="post"
  name="silvaObjects"
  tal:define="
    default_document model/get_default;
    publishables model/get_processed_items;
    assets model/get_processed_assets;
    published python:[p for p in publishables if p['is_published']];
    editables python:[p for p in publishables if p['is_editable']];
    closed python:[p for p in publishables if p['is_closed']];
    ids options/ids | python: [];
    position request/position | options/position | nothing;
    iterate string:odd;
    ct python: mangle.String.centeredTruncate;
">
  <table class="columns columns2">
    <tbody>
      <tr>
        <tal:block replace="nothing">
          _____________________ sidebar _____________________
        </tal:block>
        <td class="left">
          <metal:use-macro use-macro="view/macro_vein_navigation/macros/vein">
            <metal:fill-slot fill-slot="sidebar">
              <tal:block replace="structure python: view.service_sidebar.render(model, 'tab_edit', vein)" />
            </metal:fill-slot>
          </metal:use-macro>
        </td>

        <tal:block replace="nothing">
          _____________________ main _____________________
        </tal:block>
        <td class="main">

          <table class="listing"
            id="sortable">
            <thead>
              <tal:block replace="nothing">
                ______________ vein + title row ______________
              </tal:block>
              <tr>
                <td class="top"
                  colspan="6">
                  <h2 tal:attributes="title string:id: ${model/id}">
                    <img tal:replace="structure python:view.render_icon(model)" />
                    &#xab;<span tal:replace="structure string:${title}">title</span>&#xbb;
                  </h2>
                </td>
              </tr>

              <tal:block replace="nothing">
                ______________ top controls row ______________
              </tal:block>
              <tr class="top-controls">
                <td colspan="6">
                  <div style="float: left;"
                    tal:condition="may_change_content">
                  <input class="transport"
                    name="add_object:method"
                    type="submit"
                    value="new..."
                    title="add a new item - alt-n"
                    accesskey="n"
                    tal:attributes="onclick string:location.href='${url}/edit/add_object?meta_type='+this.form.meta_type.options[this.form.meta_type.selectedIndex].value" 
                    i18n:attributes="value;title;accesskey new_accesskey"
                  />
                  <label for="meta_type" 
                    title="access key: alt-s" 
                    accesskey="s"
                    i18n:attributes="title;accesskey select_new_item_accesskey"
                  >
                  </label>
                  <select class="transport"
                    name="meta_type"
                    id="meta_type"
                    title="select a new item: alt-s"
                    tal:attributes="onChange string:location.href='${url}/edit/add_object?meta_type='+this.options[this.selectedIndex].value"
                    i18n:attributes="title"
                  >
                    <option value="None" i18n:translate="">
                      select:
                    </option>
                    <tal:block tal:repeat="addable model/get_silva_addables">
                      <option tal:condition="python:here.service_view_registry.has_view('add', addable['name'])"
                        tal:content="python: addable['name'] == 'Silva AutoTOC' and 'Silva Automatic Table of Contents' or addable['name']"
                        tal:attributes="value addable/name" />
                    </tal:block>
                  </select>
                  </div>
                  <div class="controls"
                    style="float:right;">
                    <a class="transport"
                      href="tab_edit_import"
                      title="import xml data or a zip file: alt-i"
                      accesskey="i"
                      tal:condition="may_change_content"
                      i18n:attributes="title;accesskey import_accesskey"
                      i18n:translate=""
                    >
                      import...</a>
                    <a class="transport"
                      href="tab_status_export"
                      title="export to xml or convert for export: alt-e"
                      accesskey="e"
                      tal:condition="may_change_content"
                      i18n:attributes="title;accesskey import_accesskey"
                      i18n:translate=""
                    >
                      export...
                    </a>
                    <span tal:condition="not:may_change_content" tal:omit-tag="">
                      &nbsp;
                    </span>
                </div>
               </td>
              </tr>
            </thead>

            <tbody>
              <tal:block replace="nothing">
                ______________ listing header ______________
              </tal:block>
              <tr tal:condition="python:(default_document or publishables or assets)">
                <th class="listing-left">
                 &nbsp;
                </th>
                <th i18n:translate="">
                  modify
                </th>
                <th i18n:translate="">
                  preview
                </th>
                <th i18n:translate="">
                  modified
                </th>
                <th i18n:translate="">
                  author
                </th>
                <th class="nosort listing-right">
                  &nbsp;<span i18n:translate="" tal:omit-tag="">shift</span>&nbsp;
                </th>
              </tr>

              <tal:block replace="nothing">
                ______________ if folder is empty (XXX: check for Zope level objects?) ______________
              </tal:block>
              <tr class="odd"
                tal:condition="python: not(default_document or publishables or assets)">
                <td colspan="6" i18n:translate="">
                  There is no content here.
                </td>
              </tr>

              <tal:block replace="nothing">
                ______________ default + publishables ______________
              </tal:block>
              <tal:repeat
                repeat="item_info publishables">
                <tal:define define="
                  iterate repeat/item_info/odd">
                  <tr tal:attributes="class python: iterate and 'odd' or 'even'">
                    <tal:block replace="nothing">
                      _______ checkbox + position cell _______
                    </tal:block>
                    <td class="listing-left">
                      <input class="min"
                        type="checkbox"
                        name="ids:list"
                        tal:attributes="
                          value item_info/item_id;
                          id item_info/item_id;
                          checked python: item_info['item_id'] in ids and 'checked' or nothing;
                          "
                        onkeypress="handle_default_action(this, event, 'tab_edit_copy')"
                      />
                      <label 
                        tal:content="item_info/number"
                        tal:attributes="for item_info/item_id"
                        i18n:translate="">
                        # with index doc, starts at 0, else starts at 1
                      </label>
                    </td>
                    <tal:block replace="nothing">
                      _______ id cell _______
                    </tal:block>
                    <td style="white-space: nowrap">
                      <a class="icon"
                        tal:attributes="
                          href item_info/editor_link;
                          title item_info/meta_type;">
                        <img tal:replace="structure item_info/rendered_icon" />
                      </a>
                      <a class="blacklink"
                        title="modify"
                        tal:define="id item_info/item_id"
                        tal:content="python: ct(id, 30)"
                        tal:attributes="
                          href item_info/editor_link;
                          class item_info/status_style;"
                        i18n:attributes="title">
                        id
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ title cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="preview"
                        tal:attributes="
                          href string:${item_info/item_url}/edit/tab_preview;
                          class item_info/status_style;"
                        i18n:attributes="title"
                        tal:content="python:(item_info['title_editable'] or default)">
                          <em i18n:translate="">no title</em>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ modified date / properties downlink cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="properties"
                        tal:condition="item_info/has_modification_time"
                        tal:attributes="href string:${item_info/item_url}/edit/tab_metadata"
                        tal:content="structure item_info/modification_time"
                        i18n:attributes="title"
                      >
                        date
                      </a>
                      <a class="closed"
                        title="properties"
                        tal:condition="not:item_info/has_modification_time"
                        tal:attributes="href string:${item_info/item_url}/edit/tab_metadata"
                        i18n:attributes="title"
                      >
                        <em i18n:translate="">n/a</em>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ author / publish downlink cell _______
                    </tal:block>
                    <td>
                      <a style="float:right"
                        title="content approved, or published..."
                        tal:condition="item_info/is_published_or_approved"
                        tal:attributes="
                          href item_info/item_url;"
                        i18n:attributes="title">
                        <img alt="content approved or published"
                          border="0"
                          width="10"
                          height="10"
                          tal:attributes="src string:${root_url}/globals/checkmark.gif"
                          i18n:attributes="alt"
                        />
                      </a>
                      <a class="blacklink"
                        title="publish"
                        tal:condition="item_info/is_versioned_content"
                        tal:attributes="href string:${item_info/item_url}/edit/tab_status"
                        tal:content="structure item_info/last_author"
                        i18n:attributes="title"
                      >
                        authorname
                      </a>
                      <a class="closed"
                        title="publish"
                        tal:condition="item_info/is_container"
                        tal:attributes="href string:${item_info/item_url}/edit/tab_status"
                        i18n:attributes="title"
                      >
                        <em i18n:translate="">n/a</em>
                      </a>
                      <span 
                        tal:condition="item_info/is_content"
                        tal:replace="item_info/last_author">
                          authorname
                      </span>
                    </td>
                    <tal:block replace="nothing">
                      _______ move symbols _______
                    </tal:block>
                    <td class="listing-right">
                      <tal:block condition="python:may_change_content and not item_info['is_default']">
                        <a style="float:right"
                          title="move down"
                          tal:attributes="href string:${url}/edit/tab_edit_move_down?id=${item_info/item_id}"
                          i18n:attributes="title"
                        >
                          <img alt="move down"
                            border="0"
                            height="12"
                            width="16"
                            tal:attributes="src string:${root_url}/globals/down.gif" 
                            i18n:attributes="alt"
                          />
                        </a>
                        <a style="float:right"
                          title="move up"
                          tal:attributes="href string:${url}/edit/tab_edit_move_up?id=${item_info/item_id}"
                          i18n:attributes="title"
                        >
                          <img alt="move up"
                            border="0"
                            height="12"
                            width="16"
                            tal:attributes="src string:${root_url}/globals/up.gif" 
                            i18n:attributes="alt"
                          />
                        </a>
                      </tal:block>
                    </td>
                  </tr>
                  <tal:block replace="nothing">
                    ______________ sync cycling of row colors ______________
                  </tal:block>
                  <tal:condition condition="repeat/item_info/end">
                    <tal:define define="global iterate python:iterate == 1 and 'odd' or 'even'" />
                  </tal:condition>
                </tal:define>

              </tal:repeat>

              <tal:block replace="nothing">
                ______________ assets ______________
              </tal:block>
              <tal:block 
                condition="python:len(assets)"
                repeat="asset_info assets">

                <tal:block define="
                  odd_even python: iterate == 'odd' and 'odd' or 'even';
                  iterate repeat/asset_info/?odd_even;
                  ">
                  <tr 
                    tal:define="
                      show_top_border repeat/asset_info/start;"
                    tal:attributes="
                      class python: iterate and 'odd' or 'even';
                      style python: show_top_border and 'border-top: 1px solid #77858c' or nothing">
                    <tal:block replace="nothing">
                      _______ checkbox + position cell _______
                    </tal:block>
                    <td class="listing-left">
                      <input class="min"
                        type="checkbox"
                        name="ids:list"
                        tal:attributes="
                          value asset_info/asset_id;
                          id asset_info/asset_id;"
                      />
                      <label 
                        tal:condition="default_document"
                        tal:attributes="for asset_info/asset_id">
                        &#8211;
                      </label>
                    </td>
                    <tal:block replace="nothing">
                      _______ icon + id cell _______
                    </tal:block>
                    <td style="white-space: nowrap">
                      <tal:block condition="python: hasattr(view, 'externalEditLink_')">
                        <span style="float: right;"
                          tal:define="
                            id asset_info/asset_id;
                            asset context/?id"
                          tal:content="
                            structure python: view.externalEditLink_(asset)"
                        />
                      </tal:block>
                      
                      <a class="icon"
                        tal:attributes="
                          href asset_info/editor_link;
                          title asset_info/meta_type;">
                        <img tal:replace="structure asset_info/rendered_icon" />
                      </a>
                      <a class="blacklink"
                        href="asset"
                        title="editor"
                        tal:define="id asset_info/asset_id"
                        tal:content="python: ct(id, 30)"
                        tal:attributes="href asset_info/editor_link"
                        i18n:attributes="title content-editor;"
                      >
                        id
                      </a>

                    </td>
                    <tal:block replace="nothing">
                      _______ title cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="preview"
                        tal:content="python: asset_info['title'] or default"
                        tal:attributes="
                          href string:${asset_info/asset_url}/edit/tab_preview;
                          class asset_info/blacklink_class"
                        i18n:attributes="title"
                      >
                        <em i18n:translate="">view</em>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ modified date cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="properties"
                        tal:condition="asset_info/has_modification_time"
                        tal:attributes="href string:${asset_info/asset_url}/edit/tab_metadata"
                        tal:content="structure asset_info/modification_time"
                        i18n:attributes="title"
                      >
                        date
                      </a>
                      <a class="closed"
                        title="properties"
                        tal:condition="not: asset_info/has_modification_time"
                        tal:attributes="href string:${asset_info/asset_url}/edit/tab_metadata"
                        i18n:attributes="title"
                      >
                        <em i18n:translate="">
                          unknown
                        </em>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ author cell _______
                    </tal:block>
                    <td tal:content="structure last_author"
                      tal:define="last_author python: asset_info['last_author'] or default">
                      unknown
                    </td>
                    <tal:block replace="nothing">
                      _______ move symbols (none) _______
                    </tal:block>
                    <td>
                      &nbsp;
                    </td>
                  </tr>
                </tal:block>
              </tal:block>
              <tal:block replace="nothing">
                ______________ select all row ______________
              </tal:block>
              <tr tal:condition="python:(default_document or publishables or assets)">
                <th class="controls listing-left"
                  colspan="4">
                  <tal:block define="select_id string:ids">
                    <metal:block use-macro="view/macro_select_all/macros/select_all"/>
                  </tal:block>
                </th>
                <th class="controls listing-right" colspan="2">
                  <span tal:condition="may_change_content"
                    tal:omit-tag="">
                    <span tal:condition="python:(published or editables or closed)"
                      i18n:translate="">
                      publishing actions
                    </span>&nbsp;
                  </span>
                </th>
              </tr>
              <tal:block replace="nothing">
                ______________ controls ______________
              </tal:block>
              <tr class="controls">
                <td colspan="6">
                  <tal:block condition="may_change_content">
                    <div style="float: right;">
                      <input class="close" 
                        name="tab_edit_close:method" 
                        value="close" 
                        title="close published items: alt-l" 
                        accesskey="l" 
                        type="submit" 
                        i18n:attributes="value; title" 
                        tal:condition="python:published"
                      />
                      <input class="executor" 
                        name="tab_edit_open_now:method" 
                        value="publish now" 
                        title="publish new versions: alt-p" 
                        accesskey="p" 
                        type="submit" 
                        i18n:attributes="value; title"
                        tal:condition="python:editables or closed"
                      />
                    </div>
                    <tal:block tal:condition="python:(default_document or publishables or assets)">
                      <div style="float: left; margin-left:0.2em; margin-right:0.7em;">
                        <select class="manipulator"
                          name="new_position"
                          id="new_position"
                          title="move selected items to"
                          tal:define="length python: len(publishables) - test(default_document, 1, 0)"
                          i18n:attributes="title">
                          <option value="position">
                            <span i18n:translate="" tal:omit-tag="">position</span>:
                          </option>
                          <tal:block repeat="item python:range(length)">                            
                            <option value="0"   
                              tal:define="pos repeat/item/number"
                              tal:content="pos"
                              tal:attributes="
                                value pos;
                                selected python: str(pos) == position and 'selected' or nothing;
                                " />
                          </tal:block>
                          <option value="0"
                            tal:attributes="value python:test(default_document, len(publishables) - 1, len(publishables))"
                            i18n:translate=""
                          >
                            end
                          </option>
                        </select>
                        <label for="new_position"
                          title="access key: alt-o"
                          accesskey="o"
                          i18n:attributes="title;accesskey new_position_accesskey"
                        >
                        </label>
                        <input class="button"
                          name="tab_edit_move_to:method"
                          type="submit"
                          value="move"
                          title="move selected items into position: alt-m"
                          accesskey="m"
                          i18n:attributes="value;title;accesskey move_accesskey"
                        />
                      </div>
                      <input class="transport"
                        name="tab_edit_rename_start:method"
                        type="submit"
                        value="rename..."
                        title="rename and retitle items: alt-r"
                        accesskey="r" 
                        i18n:attributes="value;title;accesskey rename_accesskey"
                      />
                      <input class="button"
                        name="tab_edit_cut:method"
                        type="submit"
                        value="cut"
                        title="cut items: alt-x"
                        accesskey="x" 
                        i18n:attributes="value;title;accesskey cut_accesskey"
                      />               
                    </tal:block>
                  </tal:block>
                  <tal:block tal:condition="python:(default_document or publishables or assets)">
                      <input class="button"
                        name="tab_edit_copy:method"
                        type="submit"
                        value="copy"
                        title="copy items: alt-c"
                        accesskey="c" 
                        i18n:attributes="value;title;accesskey copy_accesskey"
                      />
                  </tal:block>
                  <tal:block condition="may_change_content">                  
                    <tal:block replace="nothing">
                      ______________ paste (to ghost) controls exist even
                      if there's no content (there should be something on 
                      the clipboard though). ______________
                    </tal:block>
                    <tal:block condition="python:request.has_key('__cp')">
                      <input class="button"
                        name="tab_edit_paste:method"
                        type="submit"
                        value="paste"
                        title="paste items: alt-v" 
                        accesskey="v" 
                        i18n:attributes="value;title;accesskey paste_accesskey"
                      />
                      <input class="button"
                        name="tab_edit_paste_to_ghost:method"
                        type="submit"
                        value="paste ghost"
                        title="paste (items on clipboard) as ghost objects: alt-g"
                        accesskey="g" 
                        i18n:attributes="value;title;accesskey paste_ghost_accesskey"
                      />
                    </tal:block>
                    <tal:block tal:condition="python:(default_document or publishables or assets)">
                      <input class="warning"
                        name="tab_edit_delete:method"
                        type="submit"
                        value="delete"
                        title="there's no undo: alt-d"
                        accesskey="d"
                        onclick="return confirm('Really delete?')"
                        i18n:attributes="value;title;onclick;accesskey delete_accesskey"
                      />
                    </tal:block>
                  </tal:block>
                </td>
              </tr>
            </tbody>
          </table>

        </td>
      </tr>
    </tbody>
  </table>
</form>
</metal:block>
</metal:block>
</html>
